<!DOCTYPE HTML>
<html>
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://samuel-cavalcanti.github.io/Tutorials/main.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <title>  | Tutorial Introdução ao Supercomputador - Parte 3 </title>
</head>
<body>

<main>
    
    <nav>
            <a href="https:&#x2F;&#x2F;samuel-cavalcanti.github.io&#x2F;Tutorials&#x2F;">
                        <img src="https://samuel-cavalcanti.github.io/Tutorials/npad_logo.png" alt="logo"/>
                    </a>
                <a href="javascript:void(0);" onclick="burger()" id="mobile" class="ms-Icon--GlobalNavButton"></a>
            <div id="trees">
                <input class="tree-toggle" type="checkbox" id="avancado"
                           />
                    <label class="tree-toggle-label"
                           for="avancado">avançado</label>

                    <ul class="subtree">
                        <li >
                                <a href="https://samuel-cavalcanti.github.io/Tutorials/advanced/tch-rs-tutorial/">tch-rs-example NMIST</a>
                            </li>

                            <li >
                                <a href="https://samuel-cavalcanti.github.io/Tutorials/advanced/openmp-tutorial/">Tutorial OpenMP</a>
                            </li>

                            <li >
                                <a href="https://samuel-cavalcanti.github.io/Tutorials/advanced/mpi-tutorial/">Tutorial MPI</a>
                            </li>

                            </ul>
                <input class="tree-toggle" type="checkbox" id="iniciante"
                           />
                    <label class="tree-toggle-label"
                           for="iniciante">iniciante</label>

                    <ul class="subtree">
                        <li >
                                <a href="https://samuel-cavalcanti.github.io/Tutorials/beginner/winscp-tutorial/">Copiando Arquivos através de uma Interface gráfica WinSCP (Windows)</a>
                            </li>

                            <li >
                                <a href="https://samuel-cavalcanti.github.io/Tutorials/beginner/ssh-tutorial/">Geração de chave SSH pública</a>
                            </li>

                            <li >
                                <a href="https://samuel-cavalcanti.github.io/Tutorials/beginner/putty-tutorial/">PuTTy tutoriais</a>
                            </li>

                            <li >
                                <a href="https://samuel-cavalcanti.github.io/Tutorials/beginner/rsync-tutorial/">rsync</a>
                            </li>

                            <li >
                                <a href="https://samuel-cavalcanti.github.io/Tutorials/beginner/scp-tutorial/">scp</a>
                            </li>

                            <li >
                                <a href="https://samuel-cavalcanti.github.io/Tutorials/beginner/superpc-introduction-part-2/">Tutorial Introdução ao Supercomputador - Parte 2</a>
                            </li>

                            <li >
                                <a href="https://samuel-cavalcanti.github.io/Tutorials/beginner/superpc-introduction-part-1/">Tutorial Introdução ao Supercomputador parte 1</a>
                            </li>

                            <li >
                                <a href="https://samuel-cavalcanti.github.io/Tutorials/beginner/gnome-files/">Copiando Arquivos através de uma Interface gráfica Gnome Files (linux)</a>
                            </li>

                            <li >
                                <a href="https://samuel-cavalcanti.github.io/Tutorials/beginner/mobaxterm-tutorial/">MobaXterm Tutoriais</a>
                            </li>

                            </ul>
                <input class="tree-toggle" type="checkbox" id="intermediario"
                           checked/>
                    <label class="tree-toggle-label"
                           for="intermediario">intermediário</label>

                    <ul class="subtree">
                        <li >
                                <a href="https://samuel-cavalcanti.github.io/Tutorials/intermediate/slurm-commands/">Tutorial de comandos do supercomputador</a>
                            </li>

                            <li class="active">
                                <a href="https://samuel-cavalcanti.github.io/Tutorials/intermediate/superpc-introduction-part-3/">Tutorial Introdução ao Supercomputador - Parte 3</a>
                            </li>

                            
                                    
                                    
                                        <ul id="toc">
                                            <li><a href="
                                                        https://samuel-cavalcanti.github.io/Tutorials/intermediate/superpc-introduction-part-3/#tutorial-introducao-ao-supercomputador-parte-3">Tutorial Introdução ao Supercomputador - Parte 3</a>
                                                    <ul>
                                                            <li>
                                                                    <a href="https://samuel-cavalcanti.github.io/Tutorials/intermediate/superpc-introduction-part-3/#topicos">Tópicos</a>
                                                                </li>
                                                            <li>
                                                                    <a href="https://samuel-cavalcanti.github.io/Tutorials/intermediate/superpc-introduction-part-3/#script-para-multithreading">Script para multithreading</a>
                                                                </li>
                                                            <li>
                                                                    <a href="https://samuel-cavalcanti.github.io/Tutorials/intermediate/superpc-introduction-part-3/#script-para-utilizacao-de-varios-nos">Script para utilização de vários nós</a>
                                                                </li>
                                                            <li>
                                                                    <a href="https://samuel-cavalcanti.github.io/Tutorials/intermediate/superpc-introduction-part-3/#escolha-de-qos-e-limite-no-uso-do-supercomputador">Escolha de QOS e Limite no uso do supercomputador</a>
                                                                </li>
                                                            <li>
                                                                    <a href="https://samuel-cavalcanti.github.io/Tutorials/intermediate/superpc-introduction-part-3/#receber-e-mails-sobre-inicio-e-fim-da-execucao">Receber e-mails sobre início e fim da execução</a>
                                                                </li>
                                                            <li>
                                                                    <a href="https://samuel-cavalcanti.github.io/Tutorials/intermediate/superpc-introduction-part-3/#definir-a-quantidade-de-memoria-a-ser-utilizada">Definir a quantidade de memória a ser utilizada</a>
                                                                </li>
                                                            <li>
                                                                    <a href="https://samuel-cavalcanti.github.io/Tutorials/intermediate/superpc-introduction-part-3/#carregando-softwares-disponiveis">Carregando softwares disponíveis</a>
                                                                </li>
                                                            <li>
                                                                    <a href="https://samuel-cavalcanti.github.io/Tutorials/intermediate/superpc-introduction-part-3/#utilizando-a-pasta-home">Utilizando a pasta &#x2F;home</a>
                                                                </li>
                                                            <li>
                                                                    <a href="https://samuel-cavalcanti.github.io/Tutorials/intermediate/superpc-introduction-part-3/#utilizando-o-scratch-local">Utilizando o scratch local</a>
                                                                </li>
                                                            <li>
                                                                    <a href="https://samuel-cavalcanti.github.io/Tutorials/intermediate/superpc-introduction-part-3/#utilizando-o-scratch-global">Utilizando o scratch global</a>
                                                                </li>
                                                            <li>
                                                                    <a href="https://samuel-cavalcanti.github.io/Tutorials/intermediate/superpc-introduction-part-3/#backfill-e-escolha-do-tempo-de-execucao">Backfill e escolha do tempo de execução</a>
                                                                </li>
                                                            </ul>
                                                    </li>
                                            </ul>
                                    <li >
                                <a href="https://samuel-cavalcanti.github.io/Tutorials/intermediate/install-apps/">Tutorial de instalação de programas no supercomputador</a>
                            </li>

                            </ul>
                </div>
        </nav>
    <article>

        <div id="on_right">
                <span id="search-ico" class="ms-Icon--Search"></span>
            </div>
            <div class="search-container">
                <input id="search" type="search" placeholder="Search as you type...">
                <div class="search-results">
                    <div class="search-results__header"></div>
                    <ul class="search-results__items"></ul>
                </div>
            </div>
        <div id="wrap">
            
        <h1 id="tutorial-introducao-ao-supercomputador-parte-3">Tutorial Introdução ao Supercomputador - Parte 3</h1>
<p>Nesse tutorial iremos aprender a função de algumas opções que podem ser inseridas nos scripts enviados para o supercomputador. Caso surja alguma dúvida durante o tutorial, sinta-se à vontade para entrar em contato através do e-mail <strong>atendimento&lt;at&gt;npad.ufrn.br</strong> (substituindo &lt;at&gt; por <strong>@</strong>).</p>
<h2 id="topicos">Tópicos</h2>
<ul>
<li><a href="https://samuel-cavalcanti.github.io/Tutorials/intermediate/superpc-introduction-part-3/#tutorial-introducao-ao-supercomputador-parte-3">Tutorial Introdução ao Supercomputador - Parte 3</a>
<ul>
<li><a href="https://samuel-cavalcanti.github.io/Tutorials/intermediate/superpc-introduction-part-3/#topicos">Tópicos</a></li>
<li><a href="https://samuel-cavalcanti.github.io/Tutorials/intermediate/superpc-introduction-part-3/#script-para-multithreading">Script para multithreading</a></li>
<li><a href="https://samuel-cavalcanti.github.io/Tutorials/intermediate/superpc-introduction-part-3/#script-para-utilizacao-de-varios-nos">Script para utilização de vários nós</a>
<ul>
<li><a href="https://samuel-cavalcanti.github.io/Tutorials/intermediate/superpc-introduction-part-3/#compartilhamento-dos-nos"><strong>Compartilhamento dos nós</strong></a></li>
</ul>
</li>
<li><a href="https://samuel-cavalcanti.github.io/Tutorials/intermediate/superpc-introduction-part-3/#escolha-de-qos-e-limite-no-uso-do-supercomputador">Escolha de QOS e Limite no uso do supercomputador</a>
<ul>
<li><a href="https://samuel-cavalcanti.github.io/Tutorials/intermediate/superpc-introduction-part-3/#qos-1">QOS 1</a></li>
<li><a href="https://samuel-cavalcanti.github.io/Tutorials/intermediate/superpc-introduction-part-3/#qos-2">QOS 2</a></li>
<li><a href="https://samuel-cavalcanti.github.io/Tutorials/intermediate/superpc-introduction-part-3/#qos-3">QOS 3</a></li>
</ul>
</li>
<li><a href="https://samuel-cavalcanti.github.io/Tutorials/intermediate/superpc-introduction-part-3/#receber-e-mails-sobre-inicio-e-fim-da-execucao">Receber e-mails sobre início e fim da execução</a></li>
<li><a href="https://samuel-cavalcanti.github.io/Tutorials/intermediate/superpc-introduction-part-3/#definir-a-quantidade-de-memoria-a-ser-utilizada">Definir a quantidade de memória a ser utilizada</a></li>
<li><a href="https://samuel-cavalcanti.github.io/Tutorials/intermediate/superpc-introduction-part-3/#carregando-softwares-disponiveis">Carregando softwares disponíveis</a></li>
<li><a href="https://samuel-cavalcanti.github.io/Tutorials/intermediate/superpc-introduction-part-3/#utilizando-a-pasta-home">Utilizando a pasta /home</a></li>
<li><a href="https://samuel-cavalcanti.github.io/Tutorials/intermediate/superpc-introduction-part-3/#utilizando-o-scratch-local">Utilizando o scratch local</a></li>
<li><a href="https://samuel-cavalcanti.github.io/Tutorials/intermediate/superpc-introduction-part-3/#utilizando-o-scratch-global">Utilizando o scratch global</a></li>
<li><a href="https://samuel-cavalcanti.github.io/Tutorials/intermediate/superpc-introduction-part-3/#backfill-e-escolha-do-tempo-de-execucao">Backfill e escolha do tempo de execução</a></li>
</ul>
</li>
</ul>
<h2 id="script-para-multithreading">Script para multithreading</h2>
<p>Por padrão, quando não é definido o número de núcleos a ser utilizado, o supercomputador executará o job em apenas <strong>um</strong> núcleo do nó. Para que seu programa execute em mais de um núcleo, é necessário definir no script da seguinte forma:</p>
<pre data-lang="bash" style="background-color:#eff1f5;color:#4f5b66;" class="language-bash "><code class="language-bash" data-lang="bash"><span> </span><span style="color:#a7adba;">#!/bin/bash
</span><span style="color:#a7adba;">#SBATCH --job-name=multithreading_example
</span><span style="color:#a7adba;">#SBATCH --time=0-0:5
</span><span style="color:#a7adba;">#SBATCH --cpus-per-task=32
</span><span style="color:#a7adba;">#SBATCH --hint=compute_bound
</span><span style="color:#b48ead;">export </span><span style="color:#bf616a;">OMP_NUM_THREADS</span><span>=$</span><span style="color:#bf616a;">SLURM_CPUS_PER_TASK
</span><span>
</span><span style="color:#bf616a;">./hello_threads</span><span> 32 </span><span style="color:#a7adba;">#32 threads
</span></code></pre>
<p>A opção <strong>--hint=compute_bound</strong> muda a configuração para ser um thread por core.</p>
<h2 id="script-para-utilizacao-de-varios-nos">Script para utilização de vários nós</h2>
<p>Por padrão, quando não é definido o número de nós a ser utilizado, o supercomputador executará o job em apenas <strong>um</strong> nó e em <strong>um</strong> núcleo desse nó. Para que seu programa execute em mais de um nó, é necessário definir no script da seguinte forma:</p>
<pre data-lang="bash" style="background-color:#eff1f5;color:#4f5b66;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#a7adba;">#!/bin/bash
</span><span style="color:#a7adba;">#SBATCH --nodes=2 #número de nós
</span><span style="color:#a7adba;">#SBATCH --ntasks=4 #número total de tarefas
</span><span style="color:#a7adba;">#SBATCH --ntasks-per-node=2 #número de tarefas por nó
</span><span>
</span><span style="color:#bf616a;">srun</span><span> prog1 </span><span style="color:#a7adba;">#programa a ser executado. #srun: executa jobs em paralelo
</span></code></pre>
<p>Onde <strong>--nodes</strong> indica a quantidade de nós a ser utilizada, podendo também ser definido com <strong>-N</strong>. Também se pode definir o número de tarefas por nó e a quantidade de cpus por tarefas, essas configurações estão relacionadas a paralelização com <a href="/tutoriais/mpi.php">MPI</a>. Para isso é necessário primeiramente definir o número de tarefas com a opção <strong>--ntasks</strong> ou <strong>-n</strong>. Com <strong>--ntasks-per-node</strong> é definido as tarefas por nó. Já <strong>--cpus-per-task</strong> define a quantidade de cpu por tarefas. Vale salientar que as duas últimas opções citadas não são dependentes. Com isso, pode ser que a nó que esteja utilizando seja compartilhado com outros jobs.</p>
<h3 id="compartilhamento-dos-nos"><strong>Compartilhamento dos nós</strong></h3>
<p>Outro padrão do supercomputador é, ao submeter um job o nó não será reservado exclusivamente para aquele job, podendo ser alocado mais jobs dependendo da disponibilidade dos recursos naquele nó. Caso seu programa necessite de um nó por completo, utilize a opção <strong>--exclusive</strong>. Por exemplo, para um programa que será executado em paralelo, o desempenho do programa será melhor se o programa puder utilizar os recursos por completo.</p>
<p>Outro aspecto importante do compartilhamento de nós é a não especificação da utilizaçao dos recursos. Ou seja, se seu script não conter a quantidade de nós a ser utilizado nem o número de tarefas ou outra informaçao relacionada aos recursos, será reservado os recursos completos. No caso da não especificação do nó, será reservado um nó por completo. Se foi especificado <strong>n</strong> nós e não tinha no script quanto de cpu ou memória iria utilizar, esses n nós serão reservados para sua tarefa.</p>
<h2 id="escolha-de-qos-e-limite-no-uso-do-supercomputador">Escolha de QOS e Limite no uso do supercomputador</h2>
<p>O usuário poderá enviar múltiplos jobs para o supercomputador. Porém, para permitir que mais pesquisadores compartilhem esse recurso com menos tempo de espera foram impostos limites no uso do supercomputador a partir do QOS utilizado. Comando a ser acrescentado no script de execução:</p>
<pre data-lang="bash" style="background-color:#eff1f5;color:#4f5b66;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#a7adba;">#SBATCH --qos=qosN #Subistitua N pelo tipo de QOS desejado
</span><span>
</span></code></pre>
<h3 id="qos-1">QOS 1</h3>
<p>O QOS 1 é o QOS padrão, com ele o usuário poderá enviar múltiplos jobs para o supercomputador até que se atinja o limite de 512 jobs ou 512 núcleos físicos (16 nós completos), o que ocorrer primeiro. Ex.:</p>
<pre data-lang="bash" style="background-color:#eff1f5;color:#4f5b66;" class="language-bash "><code class="language-bash" data-lang="bash"><span> </span><span style="color:#a7adba;">#!/bin/bash
</span><span> </span><span style="color:#a7adba;">#SBATCH --time=0-0:5
</span><span>
</span><span> </span><span style="color:#bf616a;">./prog1
</span></code></pre>
<h3 id="qos-2">QOS 2</h3>
<p>O QOS 2 é mais indicado para mais jobs que utilizam um nó inteiro ou jobs que utilizam alguns poucos nós. Com ele, o usuário poderá enviar múltiplos jobs para o supercomputador até que se atinja o limite de 32 jobs ou 1024 núcleos físicos (32 nós completos), o que ocorrer primeiro. Ex.:</p>
<pre data-lang="bash" style="background-color:#eff1f5;color:#4f5b66;" class="language-bash "><code class="language-bash" data-lang="bash"><span> </span><span style="color:#a7adba;">#!/bin/bash
</span><span> </span><span style="color:#a7adba;">#SBATCH --time=0-0:5
</span><span> </span><span style="color:#a7adba;">#SBATCH --cpus-per-task=32
</span><span> </span><span style="color:#a7adba;">#SBATCH --hint=compute_bound
</span><span> </span><span style="color:#a7adba;">#SBATCH --exclusive
</span><span> </span><span style="color:#a7adba;">#SBATCH --qos=qos2
</span><span>
</span><span> </span><span style="color:#bf616a;">./prog1
</span><span>
</span></code></pre>
<h3 id="qos-3">QOS 3</h3>
<p>O QOS 3 é mais indicado para mais jobs que utilizam um nó inteiro. Com ele, o usuário poderá enviar um único job para usar quantos nós desejar no supercomputador. Ex.:</p>
<pre data-lang="bash" style="background-color:#eff1f5;color:#4f5b66;" class="language-bash "><code class="language-bash" data-lang="bash"><span> </span><span style="color:#a7adba;">#!/bin/bash
</span><span> </span><span style="color:#a7adba;">#SBATCH --time=1-0:0
</span><span> </span><span style="color:#a7adba;">#SBATCH --nodes=68
</span><span> </span><span style="color:#a7adba;">#SBATCH --ntasks-per-node=32
</span><span> </span><span style="color:#a7adba;">#SBATCH --cpus-per-task=1
</span><span> </span><span style="color:#a7adba;">#SBATCH --exclusive
</span><span> </span><span style="color:#a7adba;">#SBATCH --qos=qos3
</span><span>
</span><span> </span><span style="color:#bf616a;">srun</span><span> prog1
</span></code></pre>
<h2 id="receber-e-mails-sobre-inicio-e-fim-da-execucao">Receber e-mails sobre início e fim da execução</h2>
<p>Caso deseje receber notificações por e-mail sobre início e fim de execução, utiliza-se a opção <strong>--mail-type</strong> onde se pode definir que tipo de notificação deseja receber. Se for definido <strong>ALL</strong>, as notificações recebidas serão sobre BEGIN, END, FAIL, REQUEUE e STAGE_OUT. Caso deseje apenas um evento específico utilize uma das opções, sendo as opções disponíveis: NONE, BEGIN, END, FAIL, REQUEUE, STAGE_OUT, TIME_LITMIT, TIME_LIMIT_90 (alcançou 90% do tempo limite), TIME_LIMIT_50 e ARRAY_TASKS (enviar e-mail para cada array task).</p>
<p>Também é necessário definir o e-mail que irá receber as notificações com <strong>--mail-user</strong>.</p>
<pre data-lang="bash" style="background-color:#eff1f5;color:#4f5b66;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#a7adba;">#!/bin/bash
</span><span style="color:#a7adba;">#SBATCH --mail-user=meuemail@mail.com
</span><span style="color:#a7adba;">#SBATCH --mail-type=ALL
</span><span>
</span><span style="color:#bf616a;">./prog1
</span></code></pre>
<h2 id="definir-a-quantidade-de-memoria-a-ser-utilizada">Definir a quantidade de memória a ser utilizada</h2>
<p>O supercomputador está configurado para atribuir, no mínimo, 4GB de memória por núcleo. Caso queira modificar a quantidade de memória padrão, você pode utilizar a opção <strong>--mem-per-cpu</strong>, como demonstrado no exemplo a seguir:</p>
<pre data-lang="bash" style="background-color:#eff1f5;color:#4f5b66;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#a7adba;">#!/bin/bash
</span><span style="color:#a7adba;">#SBATCH --mem-per-cpu=8000
</span><span style="color:#a7adba;">#SBATCH --cpus-per-task=8
</span><span>
</span><span style="color:#bf616a;">./prog1
</span></code></pre>
<p>O script do exemplo utiliza oito cpus e para cada cpu é reservado aproximadamente 8GB de memória. Sendo que a multiplicação entre a quantidade de memória por cpu e o número de cpus usada não pode ultrapassar de 128GB, pois esse é o limite de cada nó.</p>
<p>Também há a opção <strong>--mem</strong> que já especifica a quantidade de memória para o job por completo.</p>
<pre data-lang="bash" style="background-color:#eff1f5;color:#4f5b66;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#a7adba;">#!/bin/bash
</span><span style="color:#a7adba;">#SBATCH --mem=64000
</span><span style="color:#a7adba;">#SBATCH --cpus-per-task=8
</span><span>
</span><span style="color:#bf616a;">./prog1
</span></code></pre>
<h2 id="carregando-softwares-disponiveis">Carregando softwares disponíveis</h2>
<p>A grande maioria dos softwares científicos instalados no supercomputador são executados por módulo e, portanto, será preciso carregar seus módulos. Para verificar quais módulos estão disponíveis no supercomputador, digite no terminal do Linux o comando a seguir:</p>
<pre data-lang="bash" style="background-color:#eff1f5;color:#4f5b66;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">module</span><span> avail
</span></code></pre>
<p>Depois de verificar os módulos disponíveis, você poderá carregar aqueles dos quais você precisa utilizando um comando semelhante ao mostrado a seguir:</p>
<pre data-lang="bash" style="background-color:#eff1f5;color:#4f5b66;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">module</span><span> load libraries/zlib/1.2.11-intel-16.0.1     </span><span style="color:#a7adba;"># Substitua libraries/zlib/1.2.11-intel-16.0.1 pelo módulo desejado, inserindo seu caminho completo fornecido pelo comando module avail
</span></code></pre>
<p>Para verificar quais módulos você tem atualmente carregados, utilize o comando a seguir:</p>
<pre data-lang="bash" style="background-color:#eff1f5;color:#4f5b66;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">module</span><span> list
</span></code></pre>
<p>Para limpar todos os módulos que você tem atualmente carregados, utilize o comando a seguir:</p>
<pre data-lang="bash" style="background-color:#eff1f5;color:#4f5b66;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">module</span><span> clear
</span></code></pre>
<p>Os módulos podem ser adicionados ao script criado usando o editor de textos disponível de sua preferência, caso queira editar via linha comando, pode utilizar o editor <strong>Nano</strong>, basta você efetuar o devido carregamento dos módulos necessários, através dos comandos supracitados. Tome o cuidado apenas de, no script, carregar os módulos antes de fazer a execução do programa propriamente dito.</p>
<pre data-lang="bash" style="background-color:#eff1f5;color:#4f5b66;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#a7adba;">#!/bin/bash
</span><span style="color:#a7adba;">#SBATCH --time=0-0:5
</span><span>
</span><span style="color:#bf616a;">module</span><span> load nome-do-software </span><span style="color:#a7adba;">#nome do software que aparecerá após usar o comando module avail
</span><span style="color:#bf616a;">nome-do-software</span><span> prog1
</span></code></pre>
<h2 id="utilizando-a-pasta-home">Utilizando a pasta /home</h2>
<p>Ao logar no supercomputador, você estará na pasta home. Essa pasta possui uma comunicação via rede com o supercomputador e já está configurada para, ao submeter os scripts para o supercomputador, ler os arquivos de entrada necessários para executar o job dessa pasta, assim como arquivo log de saída que será salvo nesse mesmo local.</p>
<p>Ou seja, não é necessário utilizar comandos extras ao utilizar essa pasta. Apenas as configurações básicas do script, como o tempo estimado de execução do programa, quantidade de cpus, a fila em que deseja alocar o job e afins.</p>
<p>Uma vez com o script pronto, é só enviar o script com o comando <strong>sbatch seuscript</strong>.</p>
<pre data-lang="bash" style="background-color:#eff1f5;color:#4f5b66;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">[usuario@service0 ~</span><span>]$ sbatch meu-script.sh
</span></code></pre>
<h2 id="utilizando-o-scratch-local">Utilizando o scratch local</h2>
<p>A pasta /scratch/local fica localizada em um disco SSD em cada nó de computação, com capacidade de 110 GB para os nós r1i*n* (onde * são numerais) e 19 GB para os nós service. Como a pasta /scratch/local é local de cada nó de computação, não é possível ver o conteúdo dessas pastas locais a partir do nó de login. O nó de login também possui uma pasta /scratch/local, mas ela é diferente das demais. Logo, cada pasta /scratch/local em cada nó é diferente da pasta /scratch/local de outro nó, o que não ocorre com o home. Para utilizar a pasta /scratch/local nos jobs, é necessário que, antes de submeter os jobs, os arquivos de entrada esteja em alguma pasta compartilhada (ex: /home, /scratch/global), e que o script submetido copie alguns arquivos de entrada para a pasta /scratch/local, execute o programa desejado e mova a saída de volta para uma pasta compartilhada. O script abaixo mostra um exemplo de job que utiliza a pasta /scratch/local. Nos nós de computação, a varíável de ambiente <strong>$SCRATCH</strong> equivale a pasta /scratch/local/&lt;seu-nome-de-usuário&gt;</p>
<p>Exemplo de uso do /scratch/local:</p>
<pre data-lang="bash" style="background-color:#eff1f5;color:#4f5b66;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#a7adba;">#!/bin/bash
</span><span>
</span><span style="color:#a7adba;">#SBATCH --time=0-0:5
</span><span style="color:#a7adba;">#SBATCH --ntasks=1
</span><span>
</span><span style="color:#bf616a;">INP</span><span>=&quot;</span><span style="color:#a3be8c;">input1.in input2.in</span><span>&quot; </span><span style="color:#a7adba;">#Especifica os arquivos de entrada.
</span><span>
</span><span style="color:#bf616a;">WRKDIR</span><span>=$</span><span style="color:#bf616a;">SCRATCH</span><span style="color:#a3be8c;">/</span><span>$</span><span style="color:#bf616a;">SLURM_JOB_ID </span><span style="color:#a7adba;">#Declara variável WRKDIR.
</span><span style="color:#bf616a;">mkdir -p </span><span>$</span><span style="color:#bf616a;">WRKDIR </span><span style="color:#a7adba;">#Verifica se existe um diretório, se não, cria o diretório.
</span><span style="color:#bf616a;">cp </span><span>$</span><span style="color:#bf616a;">INP  </span><span>$</span><span style="color:#bf616a;">WRKDIR </span><span style="color:#a7adba;">#copia os arquivos de entrada para a pasta /scratch/local/$USER
</span><span style="color:#96b5b4;">cd </span><span>$</span><span style="color:#bf616a;">WRKDIR </span><span style="color:#a7adba;">#muda para a pasta /scratch/local/$USER/JOBID
</span><span style="color:#bf616a;">./prog </span><span style="color:#a7adba;">#execução normal do seu programa
</span><span style="color:#bf616a;">mv </span><span>$</span><span style="color:#bf616a;">WRKDIR</span><span>/ $</span><span style="color:#bf616a;">SLURM_SUBMIT_DIR</span><span>/#move os arquivos de saída para o diretório /home/$</span><span style="color:#bf616a;">USER
</span></code></pre>
<h2 id="utilizando-o-scratch-global">Utilizando o scratch global</h2>
<p>Na pasta /scratch/global há a comunicação via rede da mesma forma da pasta /home, mas utiliza uma banda maior, o que faz com que seja mais rápido mas não tão rápida quanto ao /scratch/local. Sendo, ainda, que essa pasta possui um sistema de leitura e escrita de arquivos em paralelo, chamado <a href="http://lustre.org">Lustre</a>.</p>
<p>Acessando a pasta /scratch/global destinada ao seu usuário:</p>
<pre data-lang="bash" style="background-color:#eff1f5;color:#4f5b66;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">[usuario@service0 ~</span><span>]$ cd $</span><span style="color:#bf616a;">SCRATCH_GLOBAL
</span></code></pre>
<p>O sistema já faz a leitura e escrita de forma paralela de acordo com a configuração, não precisando determinar através do script ou qualquer outro código a ser utilizado. A utilização fica sendo da mesma forma que na pasta /home. Como se pode ver no script exemplo:</p>
<pre data-lang="bash" style="background-color:#eff1f5;color:#4f5b66;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#a7adba;">#!/bin/bash
</span><span>
</span><span style="color:#a7adba;">#SBATCH --time=0-0:5
</span><span style="color:#a7adba;">#SBATCH --ntasks=1
</span><span>
</span><span style="color:#bf616a;">mv</span><span> param.in $</span><span style="color:#bf616a;">SCRATCH_GLOBAL </span><span style="color:#a7adba;">#move os arquivos com os parâmetros de entrada para a pasta /scratch/global
</span><span style="color:#bf616a;">./prog </span><span style="color:#a7adba;">#execução normal do seu programa
</span><span style="color:#bf616a;">mv</span><span> file.out /home/usuarioNPAD/ </span><span style="color:#a7adba;">#move os arquivos de saída para o diretório /home/&lt;seu-nome-de-usuário&gt;
</span></code></pre>
<h2 id="backfill-e-escolha-do-tempo-de-execucao">Backfill e escolha do tempo de execução</h2>
<p>O Supercomputador por padrão aloca os jobs de acordo com suas prioridades, ou seja, jobs com alta prioridade executam antes. Porém a opção backfill é utilizada para uma melhor utilização do sistema. Com isso é possível que jobs com prioridades menores sejam alocados e executados antes de jobs com alta prioridade. Isso acontece apenas no caso em que o tempo de início esperado do jobs de alta prioridade for maior que o tempo limite de execução do job de baixa prioridade.</p>
<p>O tempo de início esperado depende da finalização dos jobs em execução e o tempo limite de execução depende da opção <strong>--time</strong> no script do job. Logo, uma escolha razoável do tempo estimado de execução pode fazer com que o job comece a executar mais rápido. Ex.:</p>
<pre data-lang="bash" style="background-color:#eff1f5;color:#4f5b66;" class="language-bash "><code class="language-bash" data-lang="bash"><span> </span><span style="color:#a7adba;">#!/bin/bash
</span><span style="color:#a7adba;">#SBATCH --time=0-0:5 #Formato padrão: dias-horas:minutos
</span><span>
</span></code></pre>
<p>Para executar programas em paralelo no supercomputador, leia os tutorias de <a href="/advanced/openmp_tutorial.md">OpenMP</a> e <a href="https://samuel-cavalcanti.github.io/Tutorials/advanced/mpi-tutorial/">MPI</a>.</p>

    
        </div>

    </article>
</main>


    <script type="text/javascript" src="https://samuel-cavalcanti.github.io/Tutorials/elasticlunr.min.js" defer></script>
    <script type="text/javascript" src="https://samuel-cavalcanti.github.io/Tutorials/search_index.en.js" defer></script>
<script type="text/javascript" src="https://samuel-cavalcanti.github.io/Tutorials/js.js" defer></script>

</body>
</html>
